---
import ProjectPreviewCard from "./ProjectPreviewCard.astro";
import ProjectModal from "./ProjectModal.astro";
import projects from "../data/projects.json";
---

<section
  id="projects"
  class="bg-gray-50 dark:bg-gray-900 transition-colors duration-500"
>
  <div
    class="bg-gray-50 dark:bg-gray-900 px-12 py-8 flex items-center border-b border-gray-100 dark:border-gray-800 min-h-[118px] transition-colors duration-500"
  >
    <div class="leading-[0.8] tracking-tighter">
      <h2
        class="font-heading font-[800] text-[34px] text-blue-600 dark:text-blue-500 uppercase"
      >
        Projects
      </h2>
    </div>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full">
    {
      projects.map((project) => (
        <ProjectPreviewCard
          title={project.title}
          description={project.description}
          technologies={project.technologies}
          href={project.href}
          imageSrc={project.imageSrc}
          hoverImages={project.hoverImages}
          repoUrl={project.repoUrl}
          demoUrl={project.demoUrl}
        />
      ))
    }
  </div>

  <ProjectModal />
</section>

<script>
  function setupReveal() {
    const observerOptions = {
      threshold: 0.15,
      rootMargin: "0px 0px -50px 0px",
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.remove(
            "opacity-0",
            "translate-y-12",
            "scale-95"
          );
          entry.target.classList.add(
            "opacity-100",
            "translate-y-0",
            "scale-100"
          );
          // Once animated, we don't need to observe it anymore
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    const revealItems = document.querySelectorAll(".reveal-item");
    revealItems.forEach((item) => observer.observe(item));
  }

  setupReveal();

  document.addEventListener("astro:page-load", setupReveal);
</script>
